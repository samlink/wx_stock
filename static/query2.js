let page_query2=function(){let limit=document.querySelector("#limit").textContent,get_height=getHeight()-168,init_data={container:".table-documents",url:"/fetch_a_documents",post_data:{id:"",name:"",sort:"开单时间 DESC",rec:Math.floor(get_height/30),cate:limit},edit:!1,row_fn:function(tr){let rec=tr.split(SPLITER);rec.length;return`<tr'>\n        <td style="text-align: center;">${rec[0]}</td>\n        <td title='${rec[1]}'>${rec[1]}</td>\n        <td style="text-align: center;">${rec[2]}</td>\n        <td style="text-align: center;">${rec[3]}</td>\n        <td style="text-align: center;">${rec[4]}</td>\n        <td style="text-align: center;">${rec[5]}</td>\n        </tr>`},blank_row_fn:function(){return"<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>"}},table=document.querySelector(".table-documents"),data=service.build_table_header(table,[{name:"序号",field:"-",width:2},{name:"单号",field:"单号",width:4},{name:"类别",field:"documents.类别",width:4},{name:"日期",field:"documents.日期",width:4},{name:"经办人",field:"documents.经办人",width:3},{name:"备注",field:"documents.备注",width:8}],"","","documents");function search_table(){let search=document.querySelector("#search-input").value;Object.assign(tool_table.table_data.post_data,{name:search,page:1}),tool_table.fetch_table()}table.querySelector("thead tr").innerHTML=data.th_row,init_data.header_names=data.header_names,tool_table.table_init(init_data),tool_table.fetch_table(),document.querySelector("#serach-button").addEventListener("click",(function(){search_table()})),document.querySelector("#edit-button").addEventListener("click",(function(){let chosed=document.querySelector("tbody .focus");if(chosed){let address,id=chosed.querySelector("td:nth-child(2)").textContent,cate=chosed.querySelector("td:nth-child(3)").textContent;"材料采购"==cate?address="/buy_in/":"采购退货"==cate?address="/buy_back/":"商品销售"==cate?address="/sale/":"销售退货"==cate?address="/saleback/":"采购入库"==cate?address="/material_in/":"销售出库"==cate?address="/material_out/":"运输发货"==cate?address="/transport/":"调整入库"==cate?address="/stock_change_in/":"调整出库"==cate?address="/stock_change_out/":"销售开票"==cate&&(address="/kp/"),window.location=address+id}else notifier.show("请先选择单据","danger")})),document.querySelector("#del-button").addEventListener("click",(function(){let chosed=document.querySelector("tbody .focus"),dh=chosed?chosed.querySelector("td:nth-child(2)").textContent:"",cate=dh.substring(0,2),base="";"XS"==cate||"XT"==cate||"CG"==cate||"CT"==cate||"FH"==cate?base="document_items":"CK"==cate||"TC"==cate?base="pout_items":"RK"==cate||"TR"==cate?base="products":"KP"==cate&&(base="kp_items");let del={id:dh,rights:"删除单据",base:base};""!=dh?alert_confirm(`单据 ${dh} 删除后无法恢复，确认删除吗？`,{confirmCallBack:()=>{fetch("/documents_del",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(del)}).then((response=>response.json())).then((content=>{-1!=content?search_table():notifier.show("权限不够，操作失败","danger")}))}}):notifier.show("请先选择单据","danger")}))}();