String.prototype.trimStr=function(char,type){if(char){if(type=="left"){return this.replace(new RegExp("^\\"+char+"+","g"),"")}else if(type=="right"){return this.replace(new RegExp("\\"+char+"+$","g"),"")}return this.replace(new RegExp("^\\"+char+"+|\\"+char+"+$","g"),"")}return this.replace(/^\s+|\s+$/g,"")};Date.prototype.Format=function(fmt){var o={"M+":this.getMonth()+1,"d+":this.getDate(),"h+":this.getHours(),"m+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};if(/(y+)/.test(fmt))fmt=fmt.replace(RegExp.$1,this.getFullYear()+"");for(var k in o)if(new RegExp("("+k+")").test(fmt))fmt=fmt.replace(RegExp.$1,RegExp.$1.length==1?o[k]:("00"+o[k]).substr((""+o[k]).length));return fmt};var SPLITER="<`*_*`>";var regInt=/^[+]{0,1}(\d+)$/;var regReal=/^-?\d+(\.\d+)?$/;var regDate=/(([0-9]{3}[1-9]|[0-9]{2}[1-9][0-9]{1}|[0-9]{1}[1-9][0-9]{2}|[1-9][0-9]{3})-(((0[13578]|1[02])-(0[1-9]|[12][0-9]|3[01]))|((0[469]|11)-(0[1-9]|[12][0-9]|30))|(02-(0[1-9]|[1][0-9]|2[0-8]))))|((([0-9]{2})(0[48]|[2468][048]|[13579][26])|((0[48]|[2468][048]|[3579][26])00))-02-29)/;function padZero(num,length){return(Array(length).join("0")+num).slice(-length)}function getHeight(){let content_height=document.body.clientHeight-138;var sum=0;for(let i=0;i<arguments.length;i++){sum+=arguments[i]}return content_height-sum}function download_file(url){var downloadLink=document.createElement("a");downloadLink.href=url;document.body.appendChild(downloadLink);downloadLink.click();document.body.removeChild(downloadLink)}function checkFileType(input){var acceptType=input.getAttribute("accept");var selectedFile=input.value;var fileType=selectedFile.substring(selectedFile.indexOf(".")+1,selectedFile.length);var location=acceptType.indexOf(fileType);if(location>-1){return true}else{return false}}function append_blanks(len,m){let trs="";for(let i=0;i<len;i++){trs+="<tr>";for(let j=0;j<m;j++){trs+="<td>　</td>"}trs+="</tr>"}return trs}function append_cells(m){let tds="";for(let j=0;j<m;j++){tds+="<td></td>"}return tds}function goto_tabindex(row,idx){var inputs=row.getElementsByTagName("input");for(var i=0,j=inputs.length;i<j;i++){if(inputs[i].getAttribute("idx")==idx){inputs[i].focus();break}}return inputs[i]}function enterToTab(row,input,max_idx){var tabindex=input.getAttribute("idx");goto_tabindex(row,++tabindex);return tabindex}function set_key_move(all_input,form,max_n){all_input.forEach((input=>{input.onkeydown=function(e){var e=event?event:window.event;if(e.code=="Enter"||e.code=="NumpadEnter"){let idx=enterToTab(form,input,all_input.length);if(idx==max_n+1){goto_tabindex(form,1)}}}}))}function getLeft(element,parent){var left=element.offsetLeft;var current=element.offsetParent;while(current!==null){left+=current.offsetLeft;current=current.offsetParent}return left-parent.scrollLeft}function getTop(element,parent){var actualTop=element.offsetTop;var current=element.offsetParent;while(current!==null){actualTop+=current.offsetTop;current=current.offsetParent}return actualTop-parent.scrollTop}function moneyUppercase(n){var fraction=["角","分","厘","毫"];var digit=["零","壹","贰","叁","肆","伍","陆","柒","捌","玖"];var unit=[["元","万","亿"],["","拾","佰","仟"]];var head=n<0?"欠":"";n=Math.abs(n);var s="";for(var i=0;i<fraction.length;i++){s+=(digit[Math.floor(n*10*Math.pow(10,i))%10]+fraction[i]).replace(/零./,"")}s=s||"整";n=Math.floor(n);for(var i=0;i<unit[0].length&&n>0;i++){var p="";for(var j=0;j<unit[1].length&&n>0;j++){p=digit[n%10]+unit[1][j]+p;n=Math.floor(n/10)}s=p.replace(/(零.)*零$/,"").replace(/^$/,"零")+unit[0][i]+s}return head+s.replace(/(零.)*零元/,"元").replace(/(零.)+/g,"零").replace(/^整$/,"零元整")}function open_node(){document.querySelector("#t_4 span").click();document.querySelector("#t_3 span").click()}function alert_confirm(message,optionsA){var options={cancel:true,confirmText:"确认",cancelText:"取消",cancelCallBack:()=>{},confirmCallBack:()=>{}};if(typeof optionsA==="object"){Object.assign(options,optionsA)}let element=document.querySelector("#roar-alert");let cancelElement=document.querySelector(".roar-alert-message-button-cancel");let confirmElement=document.querySelector(".roar-alert-message-button-confirm");if(!options.cancel){cancelElement.style.display="none"}else{cancelElement.innerHTML=options.cancelText;cancelElement.addEventListener("click",(()=>{options.cancelCallBack();element.style.display="none"}))}confirmElement.innerHTML=options.confirmText;confirmElement.addEventListener("click",(()=>{options.confirmCallBack();element.style.display="none"}));document.querySelector(".roar-alert-message-content").innerHTML=message;element.style.display="block"}(function(root,factory){if(typeof exports==="object"&&typeof module==="object"){module.exports=factory()}else if(typeof define==="function"&&define.amd){define([],factory)}else if(typeof exports==="object"){exports["notifier"]=factory()}else{root["notifier"]=factory()}})(typeof self!=="undefined"?self:this,(function(){var count=0;var d=document;var myCreateElement=function(elem,attrs){var el=d.createElement(elem);for(var prop in attrs){el.setAttribute(prop,attrs[prop])}return el};var createContainer=function(){var container=myCreateElement("div",{class:"notifier-container",id:"notifier-container"});d.body.appendChild(container)};var show=function(msg,type,timeout=3e3,width=0){var ntfId="notifier-"+count;var container=d.querySelector(".notifier-container"),ntf=myCreateElement("div",{class:"notifier "+type}),ntfBody=myCreateElement("div",{class:"notifier-body"}),ntfClose=myCreateElement("button",{class:"notifier-close",type:"button"});if(width!=0){container.style.width=width+"px"}ntfBody.innerHTML=msg;ntfClose.innerHTML="×";ntf.appendChild(ntfClose);ntf.appendChild(ntfBody);container.appendChild(ntf);setTimeout((function(){ntf.className+=" shown";ntf.setAttribute("id",ntfId)}),100);if(timeout>0){setTimeout((function(){hide(ntfId)}),timeout)}ntfClose.addEventListener("click",(function(){hide(ntfId)}));count+=1;return ntfId};var hide=function(notificationId){var notification=document.getElementById(notificationId);if(notification){notification.className=notification.className.replace(" shown","");setTimeout((function(){notification.parentNode.removeChild(notification)}),600);return true}else{return false}};createContainer();return{show:show,hide:hide}}));class AutoInput{constructor(input,cate,url,cb,width){this.input=input;this.cate=cate;this.url=url;this.cb=cb;this.space=400;this.width=width}init(){var currentFocus;var input=this.input;var cb=this.cb;var width=this.width;input.addEventListener("input",(()=>{var a,b,i;var val=input.value;var space=this.space;closeAllLists();if(!val){return false}currentFocus=-1;var get_url;if(this.cate==""){get_url=`${this.url}?s=${val}`}else if(typeof this.cate=="string"){get_url=`${this.url}?s=${val}&cate=${this.cate}`}else{get_url=`${this.url}?s=${val}&cate=${this.cate.textContent?this.cate.textContent:this.cate.value}`}fetch(get_url).then((response=>response.json())).then((function(arr){if(arr!=-1&&arr.length>0){a=document.createElement("DIV");a.setAttribute("id","autocomplete-list");a.setAttribute("class","autocomplete-items");input.parentNode.appendChild(a);let top=getTop(input,document.querySelector("body"))+30;let left=getLeft(input,document.querySelector("body"));let au_width=width?width:input.clientWidth;a.style.cssText=`position:fixed; top: ${top}px; left: ${left}px; width: ${au_width}px;`;for(i=0;i<arr.length;i++){b=document.createElement("DIV");b.innerHTML=arr[i].label;b.innerHTML+="<input type='hidden' id='"+arr[i].id+"' value='"+arr[i].label+"'>";b.addEventListener("click",(function(e){e.stopPropagation();input.value=this.querySelector("input").value;input.setAttribute("data",this.querySelector("input").getAttribute("id"));closeAllLists();if(cb&&typeof cb=="function"){cb()}}));a.appendChild(b);b.style.width=au_width*.93+"px"}if(a.clientHeight>space){a.style.top=-(a.clientHeight-space+30)+"px";a.style.left="120px";a.style.borderTop="1px solid #9acffa"}}}))}));input.addEventListener("keydown",(function(e){var x=document.querySelectorAll("#autocomplete-list div");if(x.length>0){if(e.key=="ArrowDown"){currentFocus++;addActive(x)}else if(e.key=="ArrowUp"){currentFocus--;addActive(x)}else if(e.key=="Enter"){e.preventDefault();if(currentFocus>-1){x[currentFocus].click()}else{x[0].click()}}else if(e.key=="Escape"){closeAllLists()}else if(e.key=="Tab"){e.preventDefault();if(currentFocus>-1){x[currentFocus].click()}else{x[0].click()}}}}));document.addEventListener("click",(function(e){closeAllLists(e.target)}));function addActive(x){if(!x)return false;removeActive(x);if(currentFocus>=x.length)currentFocus=0;if(currentFocus<0)currentFocus=x.length-1;x[currentFocus].classList.add("autocomplete-active")}function removeActive(x){for(var i=0;i<x.length;i++){x[i].classList.remove("autocomplete-active")}}function closeAllLists(elmnt){var x=document.querySelector(".autocomplete-items");if(x&&elmnt!=x&&elmnt!=input){x.parentNode.removeChild(x)}}}}function auto_table(input,cate,url,thead,cb,cf){var currentFocus;input.addEventListener("input",(function(e){var a,b,i;var val=this.value;closeAllLists();if(!val){return false}currentFocus=-1;let get_url;if(cate!=""){let c=typeof cate=="string"?cate:cate.textContent;get_url=`${url}?s=${val}&cate=${c}`}else{get_url=`${url}?s=${val}`}if(typeof cf=="function"){get_url+=`&ss=${cf()}`}fetch(get_url).then((response=>response.json())).then((function(arr){if(arr!=-1&&arr.length>0){a=document.createElement("DIV");a.setAttribute("id","autocomplete-list");a.setAttribute("class","autocomplete-items table-auto");a.innerHTML=`<table><thead><tr></tr></thead><tbody></tbody></table>`;input.parentNode.appendChild(a);let ths="";for(let i=0;i<thead.length;i++){ths+=`<th width=${thead[i].width}>${thead[i].name}</th>`}document.querySelector(".table-auto thead tr").innerHTML=ths;let tbody=document.querySelector(".table-auto tbody");for(i=0;i<arr.length;i++){let items=arr[i].label.split(SPLITER);let tr=document.createElement("tr");tr.setAttribute("data",`${arr[i].id}${SPLITER}${arr[i].label}`);let row="";for(let i=0;i<items.length;i++){row+=`<td width=${thead[i].width}>${items[i]}</td>`}tr.innerHTML=row;tr.addEventListener("click",(function(e){e.stopPropagation();input.value=this.querySelector("td:nth-child(1)").textContent;input.setAttribute("data",this.getAttribute("data"));closeAllLists();if(cb&&typeof cb=="function"){cb()}}));tbody.appendChild(tr)}}}))}));input.addEventListener("keydown",(function(e){var x=document.querySelectorAll("#autocomplete-list tbody tr");if(x.length>0){if(e.key=="ArrowDown"){currentFocus++;addActive(x)}else if(e.key=="ArrowUp"){currentFocus--;addActive(x)}else if(e.key=="Enter"){e.preventDefault();if(currentFocus>-1){x[currentFocus].click()}else{x[0].click()}}else if(e.key=="Escape"){closeAllLists()}else if(e.key=="Tab"){e.preventDefault();if(currentFocus>-1){x[currentFocus].click()}else{x[0].click()}}}}));document.addEventListener("click",(function(e){closeAllLists(e.target)}));function addActive(x){if(!x)return false;removeActive(x);if(currentFocus>=x.length)currentFocus=0;if(currentFocus<0)currentFocus=x.length-1;x[currentFocus].classList.add("autocomplete-active")}function removeActive(x){for(var i=0;i<x.length;i++){x[i].classList.remove("autocomplete-active")}}function closeAllLists(elmnt){var x=document.querySelector(".autocomplete-items");if(x&&elmnt!=x&&elmnt!=input){x.parentNode.removeChild(x)}}}var modal_out_data={edit:0};function modal_init(){document.querySelector("#modal-close-button").addEventListener("click",(function(){document.querySelector("#modal-sumit-button").style.display="inline-block";close_modal()}));document.querySelector(".top-close").addEventListener("click",(function(){document.querySelector("#modal-sumit-button").style.display="inline-block";close_modal()}))}function close_modal(){if(modal_out_data.edit==1){alert_confirm("编辑还未保存，确认退出吗？",{confirmCallBack:()=>{modal_edit=0;document.querySelector(".modal").style.display="none"}})}else{document.querySelector(".modal").style.display="none"}document.querySelector("#modal-info").innerHTML=""}function leave_alert(){let all_input=document.querySelectorAll(".modal input");for(let input of all_input){input.addEventListener("input",(()=>{modal_edit=1}))}let all_select=document.querySelectorAll(".modal select");for(let select of all_select){select.addEventListener("change",(function(){modal_edit=1}))}}var tool_tree=function(){var global={tree_leaf:"",node_num:"",is_saved:true,name_save:"",edit_cate:"",drag_id:"",home_id:"",drag_list:[]};var selected_node,menu,zhezhao;var input_html='<input type="text" id="input_node" value="新节点">';var fetch_tree=function(func){fetch(`/tree`).then((response=>response.json())).then((data=>{var tree=document.querySelector("#tree");tree.innerHTML="";gener_tree(tree,data);var toggle=document.querySelectorAll(".item");for(let i=0;i<toggle.length;i++){toggle[i].addEventListener("click",(function(event){if(event.target.tagName!=="INPUT"){this.parentNode.querySelector(".nested").classList.toggle("active");this.classList.toggle("item-down");this.classList.toggle("item")}}))}if(typeof func=="function"){func()}}))};var tree_init=function(data){Object.assign(global,data);menu=document.querySelector("#context-menu");zhezhao=document.querySelector("#zhezhao");document.addEventListener("click",(function(event){var has_input=document.querySelector("#input_node");if(has_input&&event.target.tagName!=="INPUT"){tree_edit(has_input,selected_node)}else if(selected_node&&event.target.tagName!=="INPUT"){selected_node.classList.remove("selected");menu.style.display="none";zhezhao.style.display="none"}}));document.addEventListener("keydown",(function(event){if(event&&event.key=="Enter"){var has_input=document.querySelector("#input_node");tree_edit(has_input,selected_node)}else if(event&&event.key=="Escape"){var has_input=document.querySelector("#input_node");if(has_input&&global.edit_cate=="编辑"){zhezhao.style.display="none";has_input.parentNode.innerHTML=global.name_save}else if(has_input&&global.edit_cate=="增加"){var parent_node=has_input.parentNode.parentNode;parent_node.removeChild(has_input.parentNode);leaf_caret(parent_node);zhezhao.style.display="none"}}}));menu.addEventListener("click",(function(event){var event=event||window.event;selected_node.classList.remove("selected");this.style.display="none";event.stopPropagation()}));document.querySelector("#context-add").addEventListener("click",(function(event){global.edit_cate="增加";var new_li=document.createElement("li");if(selected_node.classList.contains("leaf")){selected_node.classList.remove("leaf");selected_node.removeEventListener("click",leaf_click);var new_ul=document.createElement("ul");var new_span=document.createElement("SPAN");new_span.classList.add("item-down");new_span.setAttribute("data-num",selected_node.dataset.num);new_span.innerHTML=selected_node.innerHTML;selected_node.innerHTML="";new_ul.classList.add("nested","active");new_ul.appendChild(new_li);selected_node.appendChild(new_span);selected_node.appendChild(new_ul);new_span.addEventListener("click",(function(){this.parentNode.querySelector(".nested").classList.toggle("active");this.classList.toggle("item-down");this.classList.toggle("item")}))}else if(selected_node.classList.contains("item")||selected_node.classList.contains("item-down")){var next_node=selected_node.nextElementSibling;next_node.appendChild(new_li);if(!next_node.classList.contains("active")){selected_node.classList.remove("item");selected_node.classList.add("item-down");next_node.classList.add("active")}}else if(selected_node.classList.contains("tree-title")){var tree=document.querySelector("#tree");tree.appendChild(new_li)}new_li.classList.add("leaf");new_li.innerHTML=input_html;new_li.addEventListener("click",leaf_click);new_li.firstChild.focus();new_li.firstChild.select();zhezhao.style.display="block"}));document.querySelector("#context-edit").addEventListener("click",(function(event){var value=selected_node.innerHTML;global.edit_cate="编辑";global.name_save=value;selected_node.innerHTML='<input type="text" id="input_node" value="'+value+'">';selected_node.firstChild.focus();zhezhao.style.display="block"}));document.querySelector("#context-del").addEventListener("click",(function(event){if(selected_node.classList.contains("leaf")||selected_node.parentNode.querySelector(".leaf")===null){let options={confirmCallBack:function(){var num={pnum:selected_node.dataset.num,node_name:""};fetch(`/tree_del`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(num)}).then((res=>res.json())).then((data=>{if(data==1){var parent_node=selected_node.parentNode;if(parent_node){parent_node.removeChild(selected_node);leaf_caret(parent_node)}}}))}};alert_confirm("删除后无法恢复，确认删除吗？",options)}else{notifier.show("有子节点，无法删除","danger")}zhezhao.style.display="none"}));document.oncontextmenu=function(event){var event=event||window.event;selected_node=event.target||event.srcElement;if(selected_node.classList.contains("leaf")||selected_node.classList.contains("item")||selected_node.classList.contains("item-down")){selected_node.classList.add("selected");return show_menu(event,"block")}else if(selected_node.classList.contains("tree-title")){return show_menu(event,"none")}};let tree_title=document.querySelector(".tree-title");tree_title.addEventListener("dragover",(function(e){e.preventDefault();e.stopPropagation();this.style.cssText="color: red; font-weight: 600;"}));tree_title.addEventListener("dragleave",(function(e){e.preventDefault();e.stopPropagation();this.style.cssText=""}));tree_title.addEventListener("drop",(function(e){e.preventDefault();e.stopPropagation();this.style.cssText="";global.home_id="#";alert_confirm("确认移动到根路径下吗？",{confirmCallBack:tree_drag})}))};let tree_search=function(value){value=value.toLowerCase();var tree=document.querySelector("#tree");var spans=tree.querySelectorAll("span");var leaves=tree.querySelectorAll(".leaf");var items=tree.querySelectorAll(".item-down");for(let item of items){item.click()}for(let span of spans){span.classList.remove("found-color");if(value!=""&&span.innerText.toLowerCase().includes(value)){span.classList.add("found-color");span.classList.remove("item");span.classList.add("item-down");span.nextElementSibling.classList.add("active");tree_change(span);find_root(span)}}for(let leaf of leaves){leaf.classList.remove("found-color");if(value!=""&&leaf.innerText.toLowerCase().includes(value)){leaf.classList.add("found-color");leaf.parentNode.classList.add("active");leaf.parentNode.previousElementSibling.classList.remove("item");leaf.parentNode.previousElementSibling.classList.add("item-down");tree_change(leaf.parentNode);find_root(leaf.parentNode)}}};function leaf_caret(parent_node){if(parent_node.children.length==0){var pp_node=parent_node.parentNode;var num2=pp_node.firstChild.dataset.num;pp_node.removeChild(parent_node);pp_node.innerHTML=pp_node.firstChild.innerHTML;pp_node.classList.add("leaf");pp_node.setAttribute("data-num",num2);pp_node.addEventListener("click",leaf_click)}}function tree_change(node){if(!node.parentNode.parentNode.hasAttribute("id")){node.parentNode.parentNode.classList.add("active");node.parentNode.parentNode.previousElementSibling.classList.remove("item");node.parentNode.parentNode.previousElementSibling.classList.add("item-down");tree_change(node.parentNode.parentNode)}}function find_root(node){let id=node.parentNode.getAttribute("id");if(id&&id=="tree"){node.parentNode.insertAdjacentElement("afterbegin",node)}else{let node_new=node.parentNode;find_root(node_new)}}function gener_tree(tree_node,data){if(data.length>0){for(let i in data){var node=document.createElement("li");node.setAttribute("id","t_"+data[i].num);node.setAttribute("draggable","true");if(data[i].children.length>0){node.innerHTML='<span class="item" data-num="'+data[i].num+'">'+data[i].node_name+"</span>";var ul=document.createElement("ul");ul.classList.add("nested");var child=gener_tree(ul,data[i].children);node.appendChild(child)}else{node.innerText=data[i].node_name;node.classList.add("leaf");node.setAttribute("data-num",data[i].num);node.addEventListener("click",leaf_click)}tree_node.appendChild(node)}return tree_node}}function leaf_click(){if(event.target.tagName=="INPUT"){return false}let self=this;if(global.node_num==this.dataset.num){return false}let get_new=function(){global.is_saved=true;global.tree_leaf=self.innerText;global.node_num=self.dataset.num;if(typeof global.leaf_click=="function"){global.leaf_click(global.node_num,self.textContent)}var leaves=document.querySelectorAll(".leaf");for(let leaf of leaves){leaf.classList.remove("is-selected")}self.classList.add("is-selected")};if(!global.is_saved){let options={confirmCallBack:get_new};alert_confirm("编辑还未保存，是否加载新内容？",options)}else{get_new()}}function show_menu(event,display){var lis=menu.querySelectorAll("li");lis[1].style.display=display;lis[2].style.display=display;menu.style.display="block";zhezhao.style.display="block";menu.style.left=event.clientX-10+"px";menu.style.top=event.clientY-10+"px";return false}function tree_edit(has_input,selected_node){if(has_input){zhezhao.style.display="none";var has_num="";if(selected_node.dataset.num){has_num=selected_node.dataset.num}var num={pnum:has_num,node_name:has_input.value};if(has_input.parentNode.dataset.num){save_edit(num)}else{save_add(num,has_input.parentNode)}has_input.parentNode.innerHTML=has_input.value}}function save_add(num,new_node){fetch(`/tree_add`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(num)}).then((response=>response.json())).then((data=>{new_node.setAttribute("data-num",data);new_node.click()}))}function save_edit(num){fetch(`/tree_edit`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(num)}).then((response=>{if(response.ok&&global.node_num==num.pnum){global.tree_leaf=num.node_name}}))}return{tree_init:tree_init,fetch_tree:fetch_tree,tree_search:tree_search}}();var tool_table=function(){var cb_function,container,resize;var table_data={};var table_init=function(data){table_data=Object.assign(data,{header:document.querySelector(data.container+" thead tr"),body:document.querySelector(data.container+" tbody"),page_input:document.querySelector(data.container+" #page-input"),page_first:document.querySelector(data.container+" #first"),page_pre:document.querySelector(data.container+" #pre"),page_aft:document.querySelector(data.container+" #aft"),page_last:document.querySelector(data.container+" #last"),total_pages:document.querySelector(data.container+" #pages"),total_records:document.querySelector(data.container+" #total-records"),other_info:document.querySelector(data.container+" #other-info")});container=data.container;table_data.page_input.value=1;table_data.page_first.disabled=true;table_data.page_pre.disabled=true;table_data.post_data.page=1;table_data.page_pre.addEventListener("click",(e=>{if(!table_data.edit){table_data.page_input.value--;change_page(table_data.page_input.value)}}));table_data.page_aft.addEventListener("click",(e=>{if(!table_data.edit){table_data.page_input.value++;change_page(table_data.page_input.value)}}));table_data.page_first.addEventListener("click",(e=>{if(!table_data.edit){change_page(1)}}));table_data.page_last.addEventListener("click",(e=>{if(!table_data.edit){change_page(table_data.total_pages.textContent)}}));table_data.page_input.addEventListener("change",(function(){if(!table_data.edit){change_page(table_data.page_input.value)}}));if(table_data.header){for(let th of table_data.header.children){th.addEventListener("click",(function(e){if(!resize&&!table_data.edit&&this.textContent!="序号"){for(let t of table_data.header.children){t.textContent=t.textContent.split(" ")[0]}let order=table_data.post_data.sort.indexOf("ASC")!==-1?"DESC":"ASC";let arrow=table_data.post_data.sort.indexOf("ASC")!==-1?"▼":"▲";let sort=table_data.header_names[this.textContent]+" "+order;Object.assign(table_data.post_data,{page:1,sort:sort});table_data.page_input.value=1;fetch_table(cb_function)}}))}}};var fetch_table=function(cb){fetch(table_data.url,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(table_data.post_data)}).then((response=>response.json())).then((content=>{if(content!=-1){let rows="";let count=0;for(let tr of content[0]){rows+=table_data.row_fn(tr);count++}for(let i=0;i<table_data.post_data.rec-count;i++){rows+=table_data.blank_row_fn()}table_data.body.innerHTML=rows;table_data.total_records.textContent=content[1];table_data.total_pages.textContent=content[2];table_data.page_input.value=table_data.post_data.page;if(table_data.other_info&&content[3]){table_data.other_info.textContent=content[3]}button_change(table_data.page_input,table_data.page_first,table_data.page_pre,table_data.page_aft,table_data.page_last,content[2]);for(let tr of table_data.body.children){tr.addEventListener("click",(function(e){if(!table_data.edit){for(let r of table_data.body.children){r.classList.remove("focus")}this.classList.add("focus");if(typeof table_data.row_click=="function"){table_data.row_click(tr)}}}))}let links=table_data.body.querySelectorAll("a");if(links.length>0){for(let l of links){l.addEventListener("click",(function(e){e.stopPropagation()}))}}table_resize();if(typeof cb=="function"){cb_function=cb;cb()}}else{alert("无此操作权限")}}))};function change_page(value){table_data.page_input.value=value>Number(table_data.total_pages.textContent)?Number(table_data.total_pages.textContent):value<1?1:value;Object.assign(table_data.post_data,{page:Number(table_data.page_input.value)});fetch_table(cb_function)}function button_change(input,first,pre,aft,last,pages){if(input.value<=1){input.value=1;first.disabled=true;pre.disabled=true}else{first.disabled=false;pre.disabled=false}if(input.value>=pages){input.value=pages;last.disabled=true;aft.disabled=true}else{last.disabled=false;aft.disabled=false}}function table_resize(){var tTD;var table=document.querySelector(container+" table");for(let j=0;j<table.rows[0].cells.length;j++){table.rows[0].cells[j].onmousedown=function(event){tTD=this;if(event.offsetX>tTD.offsetWidth-10){tTD.mouseDown=true;tTD.oldX=event.x;tTD.oldWidth=tTD.offsetWidth}};table.rows[0].cells[j].onmouseup=function(event){if(tTD==undefined)tTD=this;tTD.mouseDown=false;tTD.style.cursor="pointer";setTimeout((()=>{resize=false}),100)};table.rows[0].cells[j].onmousemove=function(event){if(event.offsetX>this.offsetWidth-10)this.style.cursor="col-resize";else this.style.cursor="pointer";if(tTD==undefined)tTD=this;if(tTD.mouseDown!=null&&tTD.mouseDown==true){tTD.style.cursor="pointer";if(tTD.oldWidth+(event.x-tTD.oldX)>0)tTD.width=tTD.oldWidth+(event.x-tTD.oldX);tTD.style.width=tTD.width;tTD.style.cursor="col-resize";table=tTD;while(table.tagName!="TABLE")table=table.parentElement;for(j=0;j<table.rows.length;j++){table.rows[j].cells[tTD.cellIndex].width=tTD.width}resize=true}}}}return{table_data:table_data,table_init:table_init,fetch_table:fetch_table}}();class MakeTable{constructor(table_data,cb){this.table_data=table_data;this.cb_function=cb}init(){let this_table=this;let table_data=this.table_data;table_data.page_input.value=1;table_data.page_first.disabled=true;table_data.page_pre.disabled=true;table_data.post_data.page=1;table_data.page_pre.addEventListener("click",(e=>{if(!table_data.edit){table_data.page_input.value--;change_page(table_data.page_input.value)}}));table_data.page_aft.addEventListener("click",(e=>{if(!table_data.edit){table_data.page_input.value++;change_page(table_data.page_input.value)}}));table_data.page_first.addEventListener("click",(e=>{if(!table_data.edit){change_page(1)}}));table_data.page_last.addEventListener("click",(e=>{if(!table_data.edit){change_page(table_data.total_pages.textContent)}}));table_data.page_input.addEventListener("change",(function(){if(!table_data.edit){change_page(table_data.page_input.value)}}));if(table_data.header){for(let th of table_data.header.children){th.addEventListener("click",(function(e){if(!table_data.edit&&th.textContent!="序号"){for(let t of table_data.header.children){t.textContent=t.textContent.split(" ")[0]}let order=table_data.post_data.sort.indexOf("ASC")!==-1?"DESC":"ASC";let arrow=table_data.post_data.sort.indexOf("ASC")!==-1?"▼":"▲";let sort=table_data.header_names[this.textContent]+" "+order;this.textContent=this.textContent+" "+arrow;Object.assign(table_data.post_data,{page:1,sort:sort});table_data.page_input.value=1;this_table.fetch_table()}}))}}function change_page(value){table_data.page_input.value=value>Number(table_data.total_pages.textContent)?Number(table_data.total_pages.textContent):value<1?1:value;Object.assign(table_data.post_data,{page:Number(table_data.page_input.value)});this_table.fetch_table()}}change_data(data){Object.assign(this.table_data.post_data,data)}fetch_table(){let table_data=this.table_data;fetch(table_data.url,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(table_data.post_data)}).then((response=>response.json())).then((content=>{if(content!=-1){let rows="";let count=0;for(let tr of content[0]){rows+=table_data.row_fn(tr);count++}for(let i=0;i<table_data.post_data.rec-count;i++){rows+=table_data.blank_row_fn()}table_data.body.innerHTML=rows;table_data.total_records.textContent=content[1];table_data.total_pages.textContent=content[2];table_data.page_input.value=table_data.post_data.page;button_change(table_data.page_input,table_data.page_first,table_data.page_pre,table_data.page_aft,table_data.page_last,content[2]);for(let tr of table_data.body.children){tr.addEventListener("click",(function(e){if(!table_data.edit){for(let r of table_data.body.children){r.classList.remove("focus")}this.classList.add("focus");if(typeof table_data.row_click=="function"){table_data.row_click(tr)}}}))}let links=table_data.body.querySelectorAll("a");if(links.length>0){for(let l of links){l.addEventListener("click",(function(e){e.stopPropagation()}))}}table_resize();if(typeof this.cb_function=="function"){this.cb_function()}}else{alert("无此操作权限")}}));function button_change(input,first,pre,aft,last,pages){if(input.value<=1){input.value=1;first.disabled=true;pre.disabled=true}else{first.disabled=false;pre.disabled=false}if(input.value>=pages){input.value=pages;last.disabled=true;aft.disabled=true}else{last.disabled=false;aft.disabled=false}}function table_resize(){var tTD;var table=table_data.table;for(let j=0;j<table.rows[0].cells.length;j++){table.rows[0].cells[j].onmousedown=function(event){tTD=this;if(event.offsetX>tTD.offsetWidth-10){tTD.mouseDown=true;tTD.oldX=event.x;tTD.oldWidth=tTD.offsetWidth}};table.rows[0].cells[j].onmouseup=function(event){if(tTD==undefined)tTD=this;tTD.mouseDown=false;tTD.style.cursor="pointer"};table.rows[0].cells[j].onmousemove=function(event){if(event.offsetX>this.offsetWidth-10)this.style.cursor="col-resize";else this.style.cursor="pointer";if(tTD==undefined)tTD=this;if(tTD.mouseDown!=null&&tTD.mouseDown==true){tTD.style.cursor="pointer";if(tTD.oldWidth+(event.x-tTD.oldX)>0)tTD.width=tTD.oldWidth+(event.x-tTD.oldX);tTD.style.width=tTD.width;tTD.style.cursor="col-resize";table=tTD;while(table.tagName!="TABLE")table=table.parentElement;for(j=0;j<table.rows.length;j++){table.rows[j].cells[tTD.cellIndex].width=tTD.width}}}}}}}var service=function(){var table_fields;let build_table_header=function(table_container,custom_fields,table_fields,last_fields,table_name){let all_width=0;for(let item of custom_fields){all_width+=item.width}if(last_fields){for(let item of last_fields){all_width+=item.width}}for(let item of table_fields){all_width+=item.show_width}let table_width=table_container.clientWidth;let width_raio=table_width/all_width;let row="";if(width_raio<18){for(let item of custom_fields){row+=`<th width='${item.width*18}px'>${item.name}</th>`}table_container.style.width=table_width;table_container.querySelector(".table-ctrl").style.cssText=`\n            position: absolute;\n            width: ${table_width+2}px;\n            margin-top: 11px;\n            border: 1px solid #edf5fb;\n            margin-left: -2px;`}else{for(let item of custom_fields){row+=`<th width='${item.width*100/all_width}%'>${item.name}</th>`}}let header_names={};for(let th of custom_fields){header_names[th.name]=th.field}for(let th of table_fields){row+=width_raio>18?`<th width="${(th.show_width*100/all_width).toFixed(1)}%">${th.show_name}</th>`:`<th width="${th.show_width*18}px">${th.show_name}</th>`;header_names[th.show_name]=`${table_name}.${th.field_name}`}if(last_fields){for(let item of last_fields){row+=width_raio<18?`<th width='${item.width*18}px'>${item.name}</th>`:`<th width='${item.width*100/all_width}%'>${item.name}</th>`;header_names[item.name]=item.field}}return{th_row:row,header_names:header_names}};let calc_weight=function(data){let tech,cz=data.cz.trim();if(cz=="718"){tech=1.05}else if(cz=="17-4"||cz=="Super13Cr"){tech=1.0064}else{tech=1}let weight=0;if(data.name=="圆钢"){weight=data.gg*data.gg*.00617*data.long*data.num*tech/1e3}else{let pipe=data.gg.split("*");weight=.02466*pipe[1]*(pipe[0]-pipe[1])*data.long*data.num*tech/1e3}return weight.toFixed(1)};let build_save_header=function(all_values,table_fields){let n=0;let save_str="";for(let f of table_fields){if(f.data_type=="文本"){save_str+=`${all_values[n].value}${SPLITER}`}else if(f.data_type=="整数"||f.data_type=="实数"){let value=all_values[n].value?all_values[n].value:0;save_str+=`${value}${SPLITER}`}else{save_str+=`${all_values[n].checked?"是":"否"}${SPLITER}`}n++}return save_str};let build_save_items=function(n,row,show_names){let save_str="";let len=show_names.length;for(let i=n;i<len;i++){if(show_names[i].is_save){if(show_names[i].type=="autocomplete"&&show_names[i].save&&show_names[i].save!="id"){let value=row.querySelector(`.${show_names[i].class}`).value;save_str+=`${value}${SPLITER}`}else if(show_names[i].type=="autocomplete"){let value=row.querySelector(`.${show_names[i].class}`).getAttribute("data").split(SPLITER)[0];save_str+=`${value}${SPLITER}`}else if(show_names[i].type=="普通输入"||show_names[i].type=="下拉列表"){let value=row.querySelector(`.${show_names[i].class}`).value;if(!value)value=row.querySelector(`.${show_names[i].class}`).textContent;save_str+=`${value.trim()}${SPLITER}`}else{let value=row.querySelector(`.${show_names[i].class}`).checked?"是":"否";save_str+=`${value}${SPLITER}`}}}return save_str};let set_sumit_shen=function(){let sumit_shen=document.createElement("Button");sumit_shen.setAttribute("id","sumit-shen");sumit_shen.classList.add("btn-info");sumit_shen.classList.add("btn");sumit_shen.classList.add("btn-sm");sumit_shen.classList.add("button-shen");sumit_shen.textContent="提交审核";document.querySelector(".fields-show").appendChild(sumit_shen)};let make_formal=function(data){if(data.button.textContent.trim()=="已审核"){return false}if(data.dh=="新单据"||data.edited){notifier.show("请先保存单据","danger");return false}if(document.querySelector("#sumit-shen")&&document.querySelector("#sumit-shen").textContent=="提交审核"){notifier.show("该单还未提交审核","danger");return false}alert_confirm("确认审核吗？",{confirmText:"确认",cancelText:"取消",confirmCallBack:()=>{fetch(`/make_formal`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({cate:data.document_name,dh:data.dh})}).then((response=>response.json())).then((content=>{if(content!=-1){data.button.textContent="已审核";data.button.classList.add("remembered");if(typeof data.readonly_fun=="function"){data.readonly_fun()}if(data.after_shen_fun){data.after_shen_fun()}if(typeof data.after_func=="function"){data.after_func(data.xsdh,data.dh)}notifier.show("审核完成","success")}else{notifier.show("权限不够","danger")}}))}})};let sumit_shen=function(data){if(data.button.textContent=="已提审核"){return false}if(data.dh=="新单据"||data.edited){notifier.show("请先保存单据","danger");return false}document.querySelector("#save-button").click();alert_confirm("确认提交审核吗？",{confirmText:"确认",cancelText:"取消",confirmCallBack:()=>{fetch(`/make_sumit_shen`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({cate:data.document_name,dh:data.dh})}).then((response=>response.json())).then((content=>{if(content!=-1){data.button.textContent="已提审核";data.button.classList.add("remembered");notifier.show("提交完成","success");setTimeout((()=>{let l=location.toString().lastIndexOf("/");location=location.toString().substring(0,l+1)+"new"}),1e3)}else{notifier.show("权限不够","danger")}}))}})};let set_shens_owner=function(data){let values=data.content.split(SPLITER);let len=values.length;document.querySelector("#owner").textContent=`[ ${values[len-1]} ]`;only_worker(values[len-1],data.readonly_fun);let shen=document.querySelector("#sumit-shen");if(values[len-5]=="true"){shen.textContent="已提审核";shen.classList.add("remembered")}else{shen.textContent="提交审核";shen.classList.remove("remembered")}let rem=document.querySelector("#remember-button");if(values[len-2]!=""){rem.textContent="已审核";rem.classList.add("remembered");data.readonly_fun()}else{rem.textContent="审核";rem.classList.remove("remembered")}if(rem.textContent=="审核"&&data.focus_fun&&typeof data.focus_fun=="function"){data.focus_fun()}};let edit_button_disabled=function(){document.querySelector("#row-insert").disabled=true;document.querySelector("#row-del").disabled=true;document.querySelector("#row-up").disabled=true;document.querySelector("#row-down").disabled=true};let only_worker=function(worker,set_readonly){if(document.querySelector("#user-name").textContent.indexOf(worker)==-1){set_readonly();let all_edit=document.querySelectorAll(".fields-show input");for(let edit of all_edit){edit.disabled=true}document.querySelector("#save-button").disabled=true}};let header_error_check=function(document_table_fields,all_rows){let da=document.querySelector("#日期");if(da&&da.value.trim()!=""&&!regDate.test(document.querySelector("#日期").value)){notifier.show("日期输入错误","danger");return false}let all_values=document.querySelectorAll(".document-value");for(let i=0;i<document_table_fields.length;i++){if(document_table_fields[i].data_type=="整数"){if(all_values[i].value&&!regInt.test(all_values[i].value)){notifier.show(`${document_table_fields[i].show_name}输入错误`,"danger");return false}}else if(document_table_fields[i].data_type=="实数"){if(all_values[i].value&&!regReal.test(all_values[i].value)){notifier.show(`${document_table_fields[i].show_name}输入错误`,"danger");return false}}}if(all_rows.length==0){notifier.show(`表格不能为空`,"danger");return false}return true};let build_row_from_string=function(rec,row,table_fields,n){if(!n)n=2;for(let name of table_fields){if(name.data_type=="文本"){row+=`<td class="${name.show_name}" title='${rec[n]}'>${rec[n]}</td>`}else if(name.data_type=="整数"||name.data_type=="实数"){row+=`<td class="${name.show_name}">${rec[n]}</td>`}else{row+=`<td class="${name.show_name}">${rec[n]}</td>`}n++}row+="</tr>";return row};let build_blank_from_fields=function(row,table_fields){for(let _f of table_fields){row+="<td></td>"}row+="</tr>";return row};let build_edit_form=function(num,table_fields,chosed){let form="<form>";for(let name of table_fields){let control;if(name.ctr_type=="普通输入"){let value=chosed.querySelector(`td:nth-child(${num})`).textContent;control=`<div class="form-group">\n                            <div class="form-label">\n                                <label>${name.show_name}</label>\n                            </div>\n                            <input class="form-control input-sm has-value" type="text" value="${value}">\n                        </div>`}else if(name.ctr_type=="二值选一"){let value=chosed.querySelector(`td:nth-child(${num})`).textContent;let options=name.option_value.split("_");let check=value==options[0]?"checked":"";control=`<div class="form-group">\n                            <div class="form-label">                                    \n                                <label>${name.show_name}</label>\n                            </div>\n                            <label class="check-radio"><input class="has-value" type="checkbox" ${check}><span class="checkmark"></span>\n                            </label>\n                        </div>`}else{let show_value=chosed.querySelector(`td:nth-child(${num})`).textContent;control=`<div class="form-group">\n                            <div class="form-label">                                    \n                                <label>${name.show_name}</label>\n                            </div>\n                            <select class='select-sm has-value'>`;let options=name.option_value.split("_");for(let value of options){if(value==show_value){control+=`<option value="${value}" selected>${value}</option>`}else{control+=`<option value="${value}">${value}</option>`}}control+="</select></div>"}form+=control;num++}form+="</form>";return form};let build_add_form=function(table_fields){let form="<form>";for(let name of table_fields){let control;if(name.ctr_type=="普通输入"){control=`<div class="form-group">\n                                <div class="form-label">\n                                    <label>${name.show_name}</label>\n                                </div>\n                                <input class="form-control input-sm has-value" type="text">\n                            </div>`}else if(name.ctr_type=="二值选一"){let checked=name.option_value.split("_")[0]==name.default_value?"checked":"";control=`<div class="form-group">\n                                <div class="form-label">                                    \n                                    <label>${name.show_name}</label>\n                                </div>\n                                <label class="check-radio">\n                                    <input class="has-value" type="checkbox" ${checked}>\n                                    <span class="checkmark"></span>\n                                </label>\n                            </div>`}else{control=`<div class="form-group">\n                                <div class="form-label">                                    \n                                    <label>${name.show_name}</label>\n                                </div>\n                                <select class='select-sm has-value'>`;let options=name.option_value.split("_");for(let value of options){let selected=value==name.default_value?"selected":"";control+=`<option value="${value}" ${selected}>${value}</option>`}control+="</select></div>"}form+=control}form+="</form>";return form};let build_inout_form=function(table_fields,data){let values=data?data.split(SPLITER):"";let form="";let idx_n=1;let n=0;for(let name of table_fields){let control;let id=`id="${name.field_name}"`;let value=values?values[n]:"";if(name.ctr_type=="普通输入"){value=value==="0"?"":value;control=`<div class="form-group">\n                                <div class="form-label">\n                                    <label>${name.show_name}</label>\n                                </div>\n                                <div class="form-input">\n                                    <input class="form-control input-sm document-value" value='${value}' idx="${idx_n++}" type="text" ${id}\n                                        style="width: ${name.show_width*20}px;" />\n                                </div>\n                            </div>`}else if(name.ctr_type=="二值选一"){let has_value=value?value:name.default_value;let checked=name.option_value.split("_")[0]==has_value?"checked":"";control=`<div class="form-group" style="display: flex;">\n                                <div class="form-label">                                    \n                                    <label class='check-label' for='${name.show_name}'>${name.show_name}</label>\n                                </div>\n                                <label class="check-radio">\n                                    <input class="document-value" id='${name.show_name}' type="checkbox"  idx="${idx_n++}" ${id} ${checked}>\n                                    <span class="checkmark"></span>\n                                </label>\n                            </div>`}else{control=`<div class="form-group">\n                                <div class="form-label">                                    \n                                    <label>${name.show_name}</label>\n                                </div>\n                                <select class='select-sm document-value' style="width: ${name.show_width*20}px;" ${id}>`;let options=name.option_value.split("_");let has_value=value?value:name.default_value;for(let value of options){let selected=value==has_value?"selected":"";control+=`<option value="${value}" ${selected}>${value}</option>`}control+="</select></div>"}form+=control;n++}return form};let sales_products=function(modal_title,init_func){if(!document.querySelector(".product-content")||modal_title!=document.querySelector(".modal-title").textContent.trim()){document.querySelector(".modal-title").textContent=modal_title;let width=document.querySelector("body").clientWidth*.8;let height=document.querySelector("body").clientHeight*.8;let tbody_height=height-270;let html=`\n            <div class="product-content">\n                <div class="tree-show">\n                    <div class="autocomplete table-top">\n                        <input type="text" class="form-control search-input" id="auto_input" placeholder="商品搜索">\n                        <button id="auto_search" class="btn btn-info btn-sm"><img src="/assets/img/zoom.png"\n                                width="20px"></button>\n                    </div>\n                    <div class="tree-title">商品分类</div>\n                    <div class="tree-container">\n                        <ul id="tree">\n                        </ul>\n                    </div>\n                </div>\n                <div id="product-show">\n                    <div class="table-top">\n                        <div class="autocomplete product-search">\n                            <input type="text" class="form-control search-input" id="search-input" placeholder="规格搜索">\n                            <button class="btn btn-info btn-sm" id="serach-button">搜索</button>\n                            <span id="product-name"></span><span id="product-id"></span>\n                        </div>\n                        <div class="table-tools">\n                        </div>\n                    </div>\n        \n                    <div class="table-container table-product">\n                        <table>\n                            <thead>\n                                <tr>\n                                    <th></th>\n                                </tr>\n                            </thead>\n                            <tbody>\n                            </tbody>\n                        </table>\n                        <div class="table-ctrl">\n                            <div class="tools-button"></div>\n                            <div class="table-button">\n                                <button class="page-button btn" id="first" title="首页"><img src="/assets/img/backward.png"\n                                        width="12px"></button>\n                                <button class="page-button btn" id="pre" title="前一页"><img src="/assets/img/backward2.png"\n                                        width="12px"></button>\n                                <p class="seperator"></p>\n                                <span>第</span><input type="text" class="form-control" id="page-input" value="1">\n                                <span>页，共</span><span id="pages"></span><span>页</span>\n                                <p class="seperator"></p>\n                                <button class="page-button btn" id="aft" title="后一页"><img src="/assets/img/forward2.png"\n                                        width="12px"></button>\n                                <button class="page-button btn" id="last" title="尾页"><img src="/assets/img/forward.png"\n                                        width="12px"></button>\n                            </div>\n        \n                            <div class="table-info">\n                                共 <span id="total-records"></span> 条记录\n                            </div>\n        \n                        </div>\n                    </div>\n                </div>\n                <div class="hide"><span id="context-menu"></span><span id="zhezhao"></span>\n                    <span id="context-add"></span><span id="context-edit"></span><span id="context-del"></span>\n                </div>\n            </div>`;document.querySelector(".modal-body").innerHTML=html;document.querySelector(".tree-container").style.height=height-240+"px";let tree_data={node_num:"",leaf_click:(id,name)=>{document.querySelector("#product-name").textContent=name;document.querySelector("#product-id").textContent=id;let post_data={cate:"现有库存",id:id,name:"",page:1,done:"否"};Object.assign(tool_table.table_data.post_data,post_data);tool_table.fetch_table(init_func)}};tree_init(tree_data);fetch_tree(open_node);let input=document.querySelector("#auto_input");document.querySelector("#auto_search").addEventListener("click",(()=>{tree_search(input.value)}));let row_num=Math.floor(tbody_height/30);build_product_table(row_num,init_func);document.querySelector(".modal-dialog").style.cssText=`max-width: ${width}px; height: ${height}px;`;document.querySelector(".modal-content").style.cssText=`height: 100%;`}document.querySelector(".modal").style.display="block"};let check_ku=function(save){let ku=new Map;let all_rows=document.querySelectorAll(".table-items .has-input");for(let row of all_rows){if(row.querySelector(".材质").textContent.trim()!=""){let key=`${row.querySelector(".m_id").textContent.trim()}##${row.querySelector(".规格").textContent.trim()}##${row.querySelector(".状态").textContent.trim()}`;let num1=row.querySelector(".num");let num=num1?num1.value:1;let l=row.querySelector(".long");let long=l?l.value:row.querySelector(".长度").value;let now_num=0;if(long&&regReal.test(long)&&num&&regReal.test(num)){now_num=long*num}if(ku.has(key)){ku.set(key,ku.get(key)+now_num)}else{ku.set(key,now_num)}}}let ku_str="";for(var[key,value]of ku){ku_str+=`${key}：${value}${SPLITER}`}ku_str=ku_str.substring(0,ku_str.lastIndexOf(SPLITER));fetch(`/check_ku`,{method:"post",headers:{"Content-Type":"application/json"},body:ku_str}).then((response=>response.json())).then((content=>{if(content==1){for(let row of all_rows){row.classList.remove("ku_danger")}save()}else if(content==-1){notifier.show("权限不够","danger")}else{for(let row of all_rows){row.classList.remove("ku_danger")}for(let c of content){let ku=c.split("#$");for(let row of all_rows){if(row.querySelector(".m_id").textContent.trim()==ku[0]&&row.querySelector(".规格").textContent.trim()==ku[1]&&row.querySelector(".状态").textContent.trim()==ku[2]){row.classList.add("ku_danger")}}}notifier.show("销售数量超过库存","danger")}}))};let chose_exit=function(selected_row,cb){let id=selected_row.children[1].textContent;if(id){fetch(`/fetch_one_product`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(id)}).then((response=>response.json())).then((content=>{let input=document.querySelector(".inputting .auto-input");input.value=content.split(SPLITER)[1];input.setAttribute("data",content);if(typeof cb=="function"){cb()}close_modal()}))}else{notifier.show("请先选择记录","danger")}};let build_product_table=function(row_num,cb,more){let init_data={container:".table-product",url:`/fetch_product`,post_data:{id:"",name:"",sort:"products.文本字段1 ASC",rec:row_num,cate:"",filter:""},edit:false,row_fn:table_row,blank_row_fn:blank_row};fetch(`/fetch_fields`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:"商品规格"})}).then((response=>response.json())).then((content=>{if(content!=-1){table_fields=content[0].filter((item=>item.is_show));let table=document.querySelector(".table-product");let header=build_table_header(table,[{name:"序号",width:3}],table_fields,"","products");table.querySelector("thead tr").innerHTML=header.th_row;init_data.header_names=header.header_names;init_data.header_names["编号"]="id";init_data.header_names["库存长度"]="products.整数字段3-COALESCE(长度合计,0)-COALESCE(切分次数,0)*2";init_data.header_names["切分"]="COALESCE(切分次数,0)";init_data.header_names["理论重量"]="库存下限-COALESCE(理重合计,0)";tool_table.table_init(init_data);let post_data={cate:document.querySelector("#p-select")?document.querySelector("#p-select").value:"现有库存",page:1};Object.assign(tool_table.table_data.post_data,post_data);tool_table.fetch_table((()=>{if(cb){cb(table)}if(more){more()}}))}}));function table_row(tr){let rec=tr.split(SPLITER);let row=`<tr><td>${rec[1]}</td><td hidden>${rec[0]}</td>`;let row_build=build_row_from_string(rec,row,table_fields);let rows=row_build.replace("</tr>",`<td class = "名称">${rec[rec.length-4]}</td>\n                                    <td class = "商品id">${rec[rec.length-3]}</td><td class = "link">${rec[rec.length-2]}</td></tr>`);return rows}function blank_row(){let row="<tr><td></td><td></td>";return build_blank_from_fields(row,table_fields)}document.querySelector("#serach-button").addEventListener("click",(function(){search_table()}));function search_table(){let search=document.querySelector("#search-input").value;Object.assign(tool_table.table_data.post_data,{name:search,page:1});let table=document.querySelector(".table-product");tool_table.fetch_table((()=>{if(cb){cb(table)}if(more){more()}}))}};let get_materials_docs=function(url,cate,build_func){fetch(url,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(cate)}).then((response=>response.json())).then((content=>{let title=document.querySelector(".table-docs thead th");title.innerHTML=title.textContent+" "+content.length+" 单";let tr="";content.forEach((obj=>{tr+=`<tr><td>${obj.label}</td></tr>`}));document.querySelector(".table-docs tbody").innerHTML=tr;let lines=document.querySelectorAll(".table-docs tbody tr");for(let l of lines){l.addEventListener("dblclick",(()=>{if(document.querySelector("#remember-button").textContent=="已审核"||document.querySelector("#save-button").disabled==true){return false}let dh=l.querySelector("td:nth-child(1)").textContent.split("　")[0];document.querySelector("#文本字段6").value=dh;build_func(dh);lines.forEach((l=>{l.classList.remove("has-bak")}));l.classList.add("has-bak");document.querySelector("#文本字段6").focus()}))}}))};let set_date=function(){let date1=document.querySelector("#search-date1");let date2=document.querySelector("#search-date2");var dateTime=new Date;let d1=dateTime.setDate(dateTime.getDate()-30);date1.value=new Date(d1).Format("yyyy-MM-dd");date2.value=(new Date).Format("yyyy-MM-dd");laydate.render({elem:date1,showBottom:false});laydate.render({elem:date2,showBottom:false})};let handle_pic=function(dh_div,save_url){let fileBtn=document.getElementById("pic_upload");document.querySelector("#pic-button").addEventListener("click",(function(e){if(dh_div.textContent=="新单据"){notifier.show("请先保存单据","danger");return false}e.preventDefault();fileBtn.click()}));fileBtn.addEventListener("change",(()=>{document.querySelector("#pic-button").disabled="true";const fd=new FormData;fd.append("file",fileBtn.files[0]);fetch(`/pic_in`,{method:"POST",body:fd}).then((res=>res.json())).then((content=>{fetch(save_url,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(`${dh_div.textContent}${SPLITER}${content.substr(1,content.length-1)}`)}).then((response=>response.json())).then((content=>{if(content==-1){notifier.show("权限不够","danger")}else if(content==-2){notifier.show("图片保存出错","danger")}else{document.querySelector("#upload-pic").src=`${content}?${Math.random()}`;document.querySelector("#pic-button").disabled="";notifier.show("图片成功保存","success")}}))}))}));document.querySelector("#upload-pic").addEventListener("click",(()=>{let pic=document.querySelector("#upload-pic").src;let show=pic.split("?")[0].replace("min_","pic_")+`?${Math.random()}`;let pic_html=`<div class = "form-input show-pic">\n                                <img width = "1190px" src = "${show}" alt = "签字图">\n                            </div>`;document.querySelector(".modal-body").innerHTML=pic_html;document.querySelector(".modal-title").textContent="签字图";document.querySelector(".modal-dialog").style.cssText="max-width: 1230px;";document.querySelector(".modal").style.display="block";document.querySelector("#modal-sumit-button").style.display="none"}))};return{table_fields:table_fields,build_table_header:build_table_header,calc_weight:calc_weight,build_save_header:build_save_header,build_save_items:build_save_items,set_sumit_shen:set_sumit_shen,make_formal:make_formal,sumit_shen:sumit_shen,set_shens_owner:set_shens_owner,edit_button_disabled:edit_button_disabled,only_worker:only_worker,header_error_check:header_error_check,build_row_from_string:build_row_from_string,build_blank_from_fields:build_blank_from_fields,build_edit_form:build_edit_form,build_add_form:build_add_form,build_inout_form:build_inout_form,sales_products:sales_products,check_ku:check_ku,chose_exit:chose_exit,build_product_table:build_product_table,get_materials_docs:get_materials_docs,set_date:set_date,handle_pic:handle_pic}}();let edit_table=function(){if(!document.querySelector(".table-history"))return;let all_width;input_data={container:document.querySelector(".table-items"),width:document.querySelector(".content").clientWidth-document.querySelector(".table-history").clientWidth-15,show_names:"",document:"入库单据"};var input_table_outdata={};document.querySelector("#row-insert").addEventListener("click",(function(e){let edit=document.querySelector(".inputting");if(edit){let table_body=document.querySelector(".table-items tbody");let input_row=build_input_row(input_data.show_names,all_width);remove_inputting();table_body.insertBefore(input_row,edit);rebuild_index();sum_records();keep_up();input_row.querySelector("td:nth-child(2)").click()}else{notifier.show("请先选择行","danger")}}));document.querySelector("#row-del").addEventListener("click",(function(e){let edit=document.querySelector(".inputting");if(edit){alert_confirm("确认删除行吗？",{confirmCallBack:()=>{edit.parentNode.removeChild(edit);sum_records();rebuild_index();keep_up();if(typeof input_data.change_func=="function"){input_data.change_func()}}})}else{notifier.show("请先选择行","danger")}}));document.querySelector("#row-up").addEventListener("click",(function(e){let edit=document.querySelector(".inputting");if(edit){if(edit.previousElementSibling){edit.parentNode.insertBefore(edit,edit.previousElementSibling);rebuild_index()}}else{notifier.show("请先选择行","danger")}}));document.querySelector("#row-down").addEventListener("click",(function(e){let edit=document.querySelector(".inputting");if(edit){if(edit.nextElementSibling&&edit.nextElementSibling.querySelector("td:nth-child(1)").textContent!=""){edit.parentNode.insertBefore(edit.nextElementSibling,edit);rebuild_index()}}else{notifier.show("请先选择行","danger")}}));let build_blank_table=function(data){Object.assign(input_data,data);let line_height=33;build_blank_th();let tbody=input_data.container.querySelector("tbody");let rows="";for(let i=0;i<input_data.lines;i++){rows+=input_data.blank_row}tbody.innerHTML=rows;tbody.style.height=input_data.lines*line_height+"px"};let build_out_table=function(data){Object.assign(input_data,data);let tbody=input_data.container.querySelector("tbody");let trs=tbody.querySelectorAll("tr");for(let tr of trs){if(!tr.classList.contains("has-input")){tr.parentNode.removeChild(tr)}}let has_input=tbody.querySelectorAll(".has-input");let num=has_input.length+1;let n=input_data.num?input_data.num:1;for(let i=0;i<n;i++){if(typeof input_data.show_names_fn=="function"){input_data.show_names_fn(i)}let input_row=build_input_row(input_data.show_names,all_width,num);tbody.appendChild(input_row);num+=1}append_blanks(tbody,num)};let appand_edit_row=function(){let tbody=input_data.container.querySelector("tbody");let trs=tbody.querySelectorAll("tr");for(let tr of trs){if(!tr.classList.contains("has-input")){tr.parentNode.removeChild(tr)}}for(let i in input_data.show_names){input_data.show_names[i].value=input_data.show_names[i].default?input_data.show_names[i].default:""}let has_input=tbody.querySelectorAll(".has-input");let num=has_input.length+1;let input_row=build_input_row(input_data.show_names,all_width,num);tbody.appendChild(input_row);num+=1;append_blanks(tbody,num)};function build_blank_th(){input_data.container.style.width=input_data.width;all_width=0;input_data.show_names.forEach((obj=>{all_width+=obj.width}));let th="<tr>";let blank="<tr>";input_data.show_names.forEach((obj=>{let hidden=obj.css?obj.css:"";th+=`<th width=${obj.width*100/all_width} ${hidden}>${obj.name}</th>`;blank+=`<td width=${obj.width*100/all_width} ${hidden}></td>`}));th+="</tr>";blank+="</tr>";input_data.container.querySelector("thead").innerHTML=th;input_data.blank_row=blank}let build_items_table=function(data){Object.assign(input_data,data);let line_height=33;build_blank_th();let tbody=input_data.container.querySelector("tbody");let num=1;for(let row of input_data.rows){let row_data=row.split(SPLITER);for(let i=1;i<input_data.show_names.length;i++){input_data.show_names[i].value=row_data[i-1]}let input_row=build_input_row(input_data.show_names,all_width,num);tbody.appendChild(input_row);num+=1}tbody.style.height=input_data.lines*line_height+"px";append_blanks(tbody,num);if(typeof input_data.change_func=="function"){input_data.change_func()}};function append_blanks(tbody,num){for(let i in input_data.show_names){if(typeof input_data.show_names[i].value=="undefined"){input_data.show_names[i].value=""}}keep_up();let rows="";for(let i=0;i<input_data.lines-num+1;i++){rows+=input_data.blank_row}tbody.querySelector("tr:nth-last-child(1)").insertAdjacentHTML("afterend",rows);setTimeout((()=>{sum_records()}),100)}function build_edit_string(show_names,all_width){let control="";let m_id=show_names[show_names.length-1].value;let idx=1;for(let obj of show_names){let hidden=obj.css?obj.css:"";if(obj.type=="普通输入"&&obj.editable){let va=obj.value?obj.value:"";control+=`<td width=${obj.width*100/all_width} class="editable" ${hidden}>\n            <input class="form-control input-sm has-value ${obj.class}" type="text" idx="${idx++}" value="${va}"></td>`}else if(obj.type=="普通输入"&&!obj.editable){control+=`<td width=${obj.width*100/all_width} class='${obj.class}' ${hidden}>${obj.value?obj.value:""} </td>`}else if(obj.type=="二值选一"&&obj.editable){let checked;if(obj.value){checked=obj.value}else{checked=""}control+=`<td width=${obj.width*100/all_width} class="editable" ${hidden}><label class="check-radio">\n                                <input class="has-value ${obj.class}" type="checkbox" ${checked}>\n                                <span class="checkmark"></span>\n                            </label>\n                        </td>`}else if(obj.type=="二值选一"&&!obj.editable){control+=`<td width=${obj.width*100/all_width}>${obj.value?obj.value:""} ${hidden}</td>`}else if(obj.type=="下拉列表"&&obj.editable){control+=`<td width=${obj.width*100/all_width} class="editable" ${hidden}><select class='select-sm has-value'>`;let options=obj.default.split("_");for(let value of options){let select=value==obj.value?"select":"";control+=`<option value="${value}" ${select}>${value}</option>`}control+="</select></td>"}else if(obj.type=="下拉列表"&&!obj.editable){control+=`<td width=${obj.width*100/all_width}>${obj.value?obj.value:""} ${hidden}</td>`}else if(obj.type=="autocomplete"&&obj.editable){let button=obj.no_button?"":"<button class='btn btn-info btn-sm product-search-button'> ... </button>";control+=`\n            <td width=${obj.width*100/all_width} class="editable" >\n                <div class="form-input autocomplete" style="z-index: 900; position: inherit">\n                    <input class="form-control input-sm has-value auto-input ${obj.class}" type="text" \n                        value="${obj.value}" idx="${idx++}" data="${m_id}">                        \n                    ${button}\n                </div>\n            </td>`}}return control}function leftright_key_move(event,row,input){var e=event?event:window.event;if(e.code=="ArrowLeft"){if(input.selectionStart==0){let tabindex=input.getAttribute("idx");let focus=goto_tabindex(row,--tabindex)}}else if(e.code=="ArrowRight"){if(input.selectionEnd==input.value.length){let tabindex=input.getAttribute("idx");let focus=goto_tabindex(row,++tabindex)}}}function updown_key_move(event,row,input,all_inputs){var e=event?event:window.event;if(e.code=="ArrowUp"){let n=row.querySelector("td:nth-child(1)").textContent;if(n!="1"){let tr=all_inputs[n-2];let tabindex=input.getAttribute("idx");goto_tabindex(tr,tabindex);remove_inputting();tr.classList.add("inputting")}}else if(e.code=="ArrowDown"){let n=row.querySelector("td:nth-child(1)").textContent;if(n!=all_inputs.length){let tr=all_inputs[n];let tabindex=input.getAttribute("idx");goto_tabindex(tr,tabindex);remove_inputting();tr.classList.add("inputting")}}}function enter_key_move(event,row,input,next_tr,max_idx){var e=event?event:window.event;if(e.code=="Enter"||e.code=="NumpadEnter"){let idx=enterToTab(row,input,max_idx);if(idx>max_idx){if(next_tr.classList.contains("has-input")){goto_tabindex(next_tr,1)}else{goto_tabindex(row,1)}}}}function auto_input_handle(input_row,auto_data){for(let auto of auto_data){let th=document.querySelector(`.table-items th:nth-child(${auto.n})`);let td=input_row.querySelector(`td:nth-child(${auto.n})`);let data={auto_th:th,auto_td:td,auto_input:td.querySelector(".auto-input")};Object.assign(auto,data);auto.auto_td.addEventListener("click",(function(){element_position(this,7.4,1)}));auto.auto_input.addEventListener("focus",(function(){remove_inputting();this.parentNode.parentNode.parentNode.classList.add("inputting")}));if(auto.type&&auto.type!="table"){let auto_comp=new AutoInput(auto.auto_input,auto.cate,auto.auto_url,"",auto.width);auto_comp.init()}else{auto_table(auto.auto_input,auto.cate,auto.auto_url,auto.show_th,auto.cb,auto.cf)}}}function build_input_row(show_names,all_width,num){if(!num)num=1;let input_row=document.createElement("tr");input_row.classList.add("has-input");input_row.innerHTML=build_edit_string(show_names,all_width);if(input_data.auto_data){auto_input_handle(input_row,input_data.auto_data)}input_row.addEventListener("click",(function(){remove_inputting();this.classList.add("inputting")}));input_row.querySelector(`td:nth-child(1)`).textContent=num;if(input_row.querySelector(".product-search-button")){input_row.querySelector(".product-search-button").addEventListener("click",(function(){if(!this.parentNode.parentNode.parentNode.classList.contains("inputting")){return false}service.sales_products("选择商品")}))}if(typeof input_data.calc_func=="function"){input_data.calc_func(input_row)}if(typeof input_data.calc_func2=="function"){input_data.calc_func2(input_row)}let max_n=input_row.querySelectorAll("input").length;input_row.querySelectorAll("input").forEach((input=>input.onkeydown=e=>{let inputs=document.querySelectorAll(".table-items .has-input");let next_tr=document.querySelector(".table-items .inputting+tr");enter_key_move(e,input_row,input,next_tr,max_n);leftright_key_move(e,input_row,input)}));return input_row}function sum_records(){let all_input=document.querySelectorAll(".has-input");let num=0;for(let i=0;i<all_input.length;i++){if(all_input[i].querySelector("td:nth-child(3)").textContent.trim()!=""||all_input[i].querySelector("td:nth-child(2) input").value.trim()!=""){num++}}if(input_data.change_func){input_data.change_func()}document.querySelector("#total-records").innerHTML=num}function rebuild_index(){let all_input=document.querySelectorAll(".has-input");for(let i=0;i<all_input.length;i++){all_input[i].querySelector("td:nth-child(1)").textContent=i+1}}function keep_up(){if(document.querySelectorAll(".table-items tbody tr").length>input_data.lines){document.querySelector(".table-items thead").style.width="calc(100% - 1.07em)"}else{document.querySelector(".table-items thead").style.width="100%"}}function remove_inputting(){let all_has_input=document.querySelectorAll(".has-input");for(let input of all_has_input){input.classList.remove("inputting")}}function remove_absolute(){let all_auto=document.querySelectorAll(".table-items .autocomplete");for(let auto of all_auto){auto.classList.remove("auto-edit");auto.style.left="";auto.style.top=""}}function element_position(element,add_x,add_y){if(element.querySelector(".autocomplete").classList.contains("auto-edit")){return false}let tbody=document.querySelector(".table-items tbody");let x=getLeft(element,tbody);let y=getTop(element,tbody);let auto_div=element.querySelector(".autocomplete");auto_div.style.left=x+add_x+"px";auto_div.style.top=y+add_y+"px";element.querySelector(".autocomplete").classList.add("auto-edit")}document.querySelector("#modal-sumit-button").addEventListener("click",(function(e){if(document.querySelector(".modal-title").textContent=="选择商品"){e.stopImmediatePropagation();let selected_row=document.querySelector("table .focus");if(selected_row){service.chose_exit(selected_row,input_data.auto_data[0].cb)}else{notifier.show("请先选择再提交","danger")}}}),false);modal_init();return{input_table_outdata:input_table_outdata,build_blank_table:build_blank_table,build_out_table:build_out_table,appand_edit_row:appand_edit_row,build_items_table:build_items_table}}();var tool_customer=function(){var customer_data={input:document.querySelector("#supplier-input"),button:document.querySelector("#supplier-serach"),auto_url:`/customer_auto`,cate:document.querySelector("#customer-suplier"),info:document.querySelector("#supplier-info")};var out_data={};let customer_init=function(data){Object.assign(customer_data,data);let auto_comp=new AutoInput(customer_data.input,customer_data.cate,customer_data.auto_url,(()=>{}));auto_comp.init();modal_init();customer_data.button.addEventListener("click",(function(){if(!document.querySelector("#customer-show")){let width=document.querySelector("body").clientWidth*.8;let height=document.querySelector("body").clientHeight*.8;let customer_height=height-270;let html=`<div id="customer-show">\n                    <div class="table-top">\n                        <div class="autocomplete customer-search">\n                            <input type="text" class="form-control search-input" id="search-input" placeholder="${customer_data.cate.textContent}搜索">\n                            <button class="btn btn-info btn-sm" id="serach-button">搜索</button>\n                        </div>\n                    </div>\n\n                    <div class="table-container table-customer">\n                        <table>\n                            <thead>\n                                <tr></tr>\n                            </thead>\n                            <tbody>\n                            </tbody>\n                        </table>\n                        <div class="table-ctrl">\n                            <div class="tools-button"></div>\n                            <div class="table-button">\n                                <button class="page-button btn" id="first" title="首页"><img src="/assets/img/backward.png"\n                                        width="12px"></button>\n                                <button class="page-button btn" id="pre" title="前一页"><img src="/assets/img/backward2.png"\n                                        width="12px"></button>\n                                <p class="seperator"></p>\n                                <span>第</span><input type="text" class="form-control" id="page-input" value="1">\n                                <span>页，共</span><span id="pages"></span><span>页</span>\n                                <p class="seperator"></p>\n                                <button class="page-button btn" id="aft" title="后一页"><img src="/assets/img/forward2.png"\n                                        width="12px"></button>\n                                <button class="page-button btn" id="last" title="尾页"><img src="/assets/img/forward.png"\n                                        width="12px"></button>\n                            </div>\n\n                            <div class="table-info">\n                                共 <span id="total-records"></span> 条记录\n                            </div>\n\n                        </div>\n                    </div>\n                </div>`;document.querySelector(".modal-body").innerHTML=html;fetch(`/fetch_inout_fields`,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(customer_data.cate.textContent)}).then((response=>response.json())).then((content=>{out_data.customer_table_fields=content;let table=document.querySelector(".table-customer");let da=service.build_table_header(table,[{name:"序号",width:3}],content,"","customers");table.querySelector("thead tr").innerHTML=da.th_row;let init_data={container:".table-customer",url:`/fetch_inout_customer`,header_names:da.header_names,post_data:{id:"",name:"",sort:"名称 ASC",rec:Math.floor(customer_height/30),cate:customer_data.cate.textContent},edit:false,row_fn:customer_table_row,blank_row_fn:customer_blank_row};tool_table.table_init(init_data);tool_table.fetch_table((()=>{row_dbclick(table)}))}));document.querySelector("#serach-button").onclick=function(){search_table()};document.querySelector(".modal-title").textContent=`选择${customer_data.cate.textContent}`;document.querySelector(".modal-dialog").style.cssText=`max-width: ${width}px; height: ${height}px;`;document.querySelector(".modal-content").style.cssText=`height: 100%;`}document.querySelector(".modal").style.display="block"}));document.querySelector("#modal-sumit-button").addEventListener("click",(function(e){let cate=document.querySelector(".modal-title").textContent;if(cate=="选择客户"||cate=="选择供应商"){let selected_row=document.querySelector("table .focus");if(selected_row){chose_exit(selected_row)}else{notifier.show("请先选择再提交","danger")}}}),false)};function customer_table_row(tr){let rec=tr.split(SPLITER);let row=`<tr><td style="text-align: center;">${rec[1]}</td><td hidden>${rec[0]}</td>`;return service.build_row_from_string(rec,row,out_data.customer_table_fields)}function customer_blank_row(){let row="<tr><td></td><td hidden></td>";return service.build_blank_from_fields(row,out_data.customer_table_fields)}function row_dbclick(table){let rows=table.querySelectorAll("body tr");for(let row of rows){row.addEventListener("dblclick",(function(){chose_exit(this)}))}}function search_table(){let table=document.querySelector(".table-customer");let search=document.querySelector("#search-input").value;Object.assign(table_data.post_data,{name:search,page:1});tool_table.fetch_table((()=>{row_dbclick(table)}))}function chose_exit(selected_row){let id=selected_row.children[1].textContent;if(id){let name=selected_row.children[2].textContent;let supplier=document.querySelector("#supplier-input");supplier.value=name;supplier.setAttribute("data",id);close_modal()}else{notifier.show("请先选择记录","danger")}}return{customer_init:customer_init}}();