document.querySelector("#title").classList.add("show-chosed");let now=new Intl.DateTimeFormat("fr-CA").format(new Date),now2=now.split("-");document.querySelector("#date-now").textContent=`${now2[0]}年${now2[1]}月${now2[2]}日`;var ctx1=document.getElementById("myChart1").getContext("2d"),ctx2=document.getElementById("myChart2").getContext("2d");let da=new Date(Date.now()),da2=da.setDate(da.getDate()-365),date1=new Intl.DateTimeFormat("fr-CA").format(da2),date2=new Intl.DateTimeFormat("fr-CA").format(new Date),data1={statis_cate:"按月",date1:date1,date2:date2};set_chart1(data1);let data2={statis_cate:"按月",num:12};function get_address(cate){let address;return"材料采购"==cate?address="/buy_query":"商品销售"==cate||"销售退货"==cate?address="/sale_query":"采购入库"==cate?address="/change_query_in":"销售出库"==cate?address="/change_query_out":"运输发货"==cate?address="/trans_query":"调整入库"==cate?address="/stock_query_in":"调整出库"==cate&&(address="/stock_query_out"),address}function show_reminders(data){let add=0;data.lines>=data.content.length?data.lines=data.content.length:(data.lines--,add=1);let line="<ul>";for(let i=0;i<data.lines;i++)line+=`<li>${data.content[i]}</li>`;line+="</ul>",1==add&&(line+=`<div class="more-tip"> <a href=${data.more_href}>更多......</a></div>`),data.title_holer.textContent=data.title,data.reminder.innerHTML=line,data.alter_func?data.alter_func():data.reminder.querySelectorAll("li").forEach((li=>{li.addEventListener("click",(()=>{window.location.href=`${data.location}${li.textContent.split("　")[0]}`}))}))}function set_chart1(data){fetch("/fetch_statis",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then((response=>response.json())).then((content=>{-1!=content&&new Chart(ctx1,{type:"bar",data:{labels:content[1],datasets:[{label:"销售额",data:content[2],backgroundColor:"rgba(54, 162, 235, 0.5)",borderColor:"rgba(54, 162, 235, 1)",borderWidth:1}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0}}]},responsive:!0,maintainAspectRatio:!1,hover:{animationDuration:0},animation:{onComplete:function(){var chartInstance=this;let ctx=chartInstance.ctx;ctx.fillStyle="dark-gray",ctx.textAlign="center",ctx.textBaseline="bottom",this.data.datasets.forEach((function(dataset,i){chartInstance.controller.getDatasetMeta(i).data.forEach((function(bar,index){var data=dataset.data[index];ctx.fillText(data,bar._model.x,bar._model.y-5)}))}))}}}})}))}function set_chart2(data){fetch("/fetch_cost",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(data)}).then((response=>response.json())).then((content=>{-1!=content&&new Chart(ctx2,{type:"line",data:{labels:content[1].reverse(),datasets:[{label:"库存重量",data:content[2].reverse(),backgroundColor:"rgba(255, 99, 132, 0.5)",borderColor:"rgba(255, 99, 132, 1)",borderWidth:1,fill:!1}]},options:{responsive:!0,maintainAspectRatio:!1}})}))}set_chart2(data2),fetch("/home_statis",{method:"post",headers:{"Content-Type":"application/json"}}).then((response=>response.json())).then((content=>{if(-1!=content){let reminder=document.querySelector("#show-01 .reminder"),fit_lines=Math.floor(reminder.clientHeight/33);show_reminders({content:content[0],lines:fit_lines,reminder:reminder,title_holer:document.querySelector("#sale-data"),title:`销售未收款 ${content[0].length} 单`,more_href:"/sale_query?s=wait_money",location:"/sale/"}),show_reminders({content:content[1],lines:fit_lines,reminder:document.querySelector("#show-02 .reminder"),title_holer:document.querySelector("#sale-data2"),title:`销售未发货 ${content[1].length} 单`,more_href:"/sale_query?s=wait_trans",location:"/sale/"}),show_reminders({content:content[2],lines:fit_lines,reminder:document.querySelector("#show-03 .reminder"),title_holer:document.querySelector("#buy-data"),title:`采购未入库 ${content[2].length} 单`,more_href:"/buy_query?s=wait_in",location:"/buy_in/"}),show_reminders({content:content[3],lines:fit_lines,reminder:document.querySelector("#show-04 .reminder"),title_holer:document.querySelector("#warn-data2"),title:`待审核 ${content[3].length} 类单据`,alter_func:function(){this.reminder.querySelectorAll("li").forEach((li=>{li.addEventListener("click",(()=>{let cate=li.textContent.split("　")[0];window.location.href=`${get_address(cate)}?s=wait_shen`}))}))}}),show_reminders({content:content[4],lines:fit_lines,reminder:document.querySelector("#show-05 .reminder"),title_holer:document.querySelector("#warn-data3"),title:`待质检 ${content[4].length} 单`,more_href:"/change_query_in?s=wait_check",location:"/material_in/"}),show_reminders({content:content[5],lines:fit_lines,reminder:document.querySelector("#show-06 .reminder"),title_holer:document.querySelector("#pre-data"),title:`未提交审核 ${content[5].length} 类单据`,alter_func:function(){this.reminder.querySelectorAll("li").forEach((li=>{li.addEventListener("click",(()=>{let cate=li.textContent.split("　")[0];window.location.href=`${get_address(cate)}?s=pre_shen`}))}))}})}})),document.querySelector("#sale-tip").addEventListener("click",(function(){window.location.href="/sale_query?s=wait_money"})),document.querySelector("#buy-tip").addEventListener("click",(function(){window.location.href="/sale_query?s=wait_trans"})),document.querySelector("#warn-tip").addEventListener("click",(function(){window.location.href="/buy_query?s=wait_in"})),document.querySelector("#use-tip").addEventListener("click",(function(){window.location.href="/change_query_in?s=wait_check"}));