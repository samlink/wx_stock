import{table_data,table_init,fetch_table}from"../parts/table.mjs";import{notifier}from"../parts/notifier.mjs";import{alert_confirm}from"../parts/alert.mjs";import{getHeight,SPLITER}from"../parts/tools.mjs";import*as service from"../parts/service.mjs";let table_fields,limit=document.querySelector("#limit").textContent,get_height=getHeight()-168,row_num=Math.floor(get_height/30),init_data={container:".table-documents",url:"/fetch_a_documents",post_data:{id:"",name:"",sort:"开单时间 DESC",rec:row_num,cate:limit},edit:!1,row_fn:table_row,blank_row_fn:blank_row},custom_fields=[{name:"序号",field:"-",width:2},{name:"单号",field:"单号",width:4},{name:"类别",field:"documents.类别",width:4},{name:"日期",field:"documents.日期",width:4},{name:"经办人",field:"documents.经办人",width:3},{name:"备注",field:"documents.备注",width:8}],table=document.querySelector(".table-documents"),data=service.build_table_header(table,custom_fields,"","","documents");function table_row(tr){let rec=tr.split(SPLITER);rec.length;return`<tr'>\n        <td style="text-align: center;">${rec[0]}</td>\n        <td title='${rec[1]}'>${rec[1]}</td>\n        <td style="text-align: center;">${rec[2]}</td>\n        <td style="text-align: center;">${rec[3]}</td>\n        <td style="text-align: center;">${rec[4]}</td>\n        <td style="text-align: center;">${rec[5]}</td>\n        </tr>`}function blank_row(){return"<tr><td></td><td></td><td></td><td></td><td></td><td></td></tr>"}function search_table(){let search=document.querySelector("#search-input").value;Object.assign(table_data.post_data,{name:search,page:1}),fetch_table()}console.log(data),table.querySelector("thead tr").innerHTML=data.th_row,init_data.header_names=data.header_names,console.log(init_data),table_init(init_data),fetch_table(),document.querySelector("#serach-button").addEventListener("click",(function(){search_table()})),document.querySelector("#edit-button").addEventListener("click",(function(){let chosed=document.querySelector("tbody .focus");if(chosed){let address,id=chosed.querySelector("td:nth-child(2)").textContent,cate=chosed.querySelector("td:nth-child(3)").textContent;"材料采购"==cate?address="/buy_in/":"采购退货"==cate?address="/buy_back/":"商品销售"==cate?address="/sale/":"销售退货"==cate?address="/saleback/":"采购入库"==cate?address="/material_in/":"销售出库"==cate?address="/material_out/":"运输发货"==cate?address="/transport/":"调整入库"==cate?address="/stock_change_in/":"调整出库"==cate?address="/stock_change_out/":"销售开票"==cate&&(address="/kp/"),window.location=address+id}else notifier.show("请先选择单据","danger")})),document.querySelector("#del-button").addEventListener("click",(function(){let chosed=document.querySelector("tbody .focus"),id=chosed?chosed.querySelector("td:nth-child(2)").textContent:"",del={id:id,rights:"删除单据",base:document.querySelector("#base").textContent};""!=id?alert_confirm(`单据 ${id} 删除后无法恢复，确认删除吗？`,{confirmCallBack:()=>{fetch("/documents_del",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(del)}).then((response=>response.json())).then((content=>{-1!=content?search_table():notifier.show("权限不够，操作失败","danger")}))}}):notifier.show("请先选择单据","danger")}));