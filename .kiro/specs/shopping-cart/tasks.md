# 购物车功能实施计划

- [x] 1. 创建数据库表和后端基础结构
  - 创建购物车数据表的SQL脚本
  - 实现购物车Rust模块的基础结构和数据模型
  - 在main.rs中注册购物车路由
  - _需求: 1.1, 4.1, 4.2, 4.3, 4.4, 4.5_

- [ ] 2. 实现后端API接口
- [ ] 2.1 实现添加商品到购物车的API接口
  - 编写POST /stock/cart/add接口处理函数
  - 实现用户认证验证和物料号验证
  - 处理数据库插入和更新逻辑（支持数量累加）
  - 实现错误处理和响应格式
  - _需求: 2.1, 2.2, 2.3, 4.1, 4.2, 4.4_

- [ ] 2.2 实现获取购物车数量的API接口
  - 编写GET /stock/cart/count接口处理函数
  - 实现用户购物车商品数量统计查询
  - 优化数据库查询性能
  - _需求: 1.2, 1.3, 4.3_

- [ ] 2.3 实现获取购物车商品列表的API接口（预留功能）
  - 编写GET /stock/cart/items接口处理函数
  - 实现分页和排序功能
  - 返回完整的商品信息
  - _需求: 4.3, 4.5_

- [x] 3. 创建前端购物车UI组件
- [x] 3.1 在productset.rs.html中添加购物车图标
  - 在页面顶部右侧区域添加购物车图标HTML结构
  - 添加数量角标显示元素
  - 确保与现有header样式保持一致
  - _需求: 1.1, 1.2_

- [x] 3.2 在产品表格中添加加号按钮
  - 修改service.js中的table_row函数，在每行前添加加号按钮
  - 设置按钮的样式和事件绑定结构
  - 确保按钮与现有表格样式协调
  - _需求: 2.1, 2.2_

- [x] 4. 实现购物车JavaScript功能模块
- [x] 4.1 创建CartManager类
  - 实现购物车管理器的基础结构
  - 编写初始化方法，从后端获取当前购物车数量
  - 实现添加商品到购物车的方法，包含API调用和错误处理
  - 实现购物车数量显示更新方法
  - _需求: 1.3, 2.2, 2.3, 2.4, 5.1, 5.2_

- [x] 4.2 实现动画效果功能
  - 创建AnimationController类处理各种动画效果
  - 实现商品飞向购物车的动画效果
  - 实现购物车数量角标的+1增加动画
  - 实现按钮点击反馈动画和加载状态
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [x] 4.3 集成购物车功能到productset.js
  - 在productset.js中初始化CartManager实例
  - 为所有加号按钮绑定点击事件处理器
  - 实现页面加载时购物车数量的获取和显示
  - 处理用户交互和状态管理
  - _需求: 2.2, 2.3, 2.4, 3.5, 5.1_

- [ ] 5. 添加购物车相关样式
- [ ] 5.1 创建购物车图标和角标的CSS样式
  - 设计购物车图标的位置和大小样式
  - 实现数量角标的圆形背景和数字显示
  - 确保在不同屏幕尺寸下的响应式显示
  - _需求: 1.1, 1.2, 1.4_

- [ ] 5.2 创建加号按钮的CSS样式
  - 设计加号按钮的外观和悬停效果
  - 实现按钮的加载状态样式
  - 确保与现有表格样式的协调性
  - _需求: 2.1, 2.5_

- [ ] 5.3 实现动画效果的CSS样式
  - 编写商品飞行动画的CSS关键帧
  - 实现数量增加的动画效果样式
  - 添加按钮点击反馈的过渡效果
  - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 6. 实现错误处理和用户反馈
- [ ] 6.1 添加前端错误处理机制
  - 处理网络请求失败的情况
  - 实现用户未登录时的处理逻辑
  - 添加服务器错误的用户友好提示
  - 使用现有的notifier组件显示错误信息
  - _需求: 2.5, 5.3_

- [ ] 6.2 实现操作成功的反馈机制
  - 显示商品成功添加到购物车的提示
  - 实现操作过程中的加载状态指示
  - 提供清晰的用户操作反馈
  - _需求: 2.4, 3.3, 5.2_

- [-] 7. 添加多语言支持
- [x] 7.1 添加购物车相关的中英文文本
  - 在productset.js中添加购物车相关的中英文文本映射
  - 实现购物车图标标题和提示信息的多语言显示
  - 确保错误信息和成功提示的多语言支持
  - _需求: 1.1, 2.4, 2.5_

- [ ] 8. 性能优化和最终集成
- [ ] 8.1 优化数据库查询性能
  - 为购物车表添加必要的数据库索引
  - 优化购物车数量查询的SQL语句
  - 测试大量数据情况下的查询性能
  - _需求: 5.1, 5.2, 5.5_

- [ ] 8.2 测试完整功能流程
  - 测试添加商品到购物车的完整流程
  - 验证动画效果的流畅性和正确性
  - 测试错误处理和边界情况
  - 确保多语言切换的正确性
  - _需求: 1.1, 1.2, 1.3, 1.4, 1.5, 2.1, 2.2, 2.3, 2.4, 2.5, 3.1, 3.2, 3.3, 3.4, 3.5, 4.1, 4.2, 4.3, 4.4, 4.5, 5.1, 5.2, 5.3, 5.4, 5.5_